#include <Arduino.h>


#define led_1 18
#define led_2 19
#define led_3 21
#define pot 34

String eleccion;
String settings;

int num, led, tiempo;
int activar = 0;
int enviar = 0;

void menu(void);
void voltaje(void);
void leds(int led, int tiempo);

void setup() {
  Serial.begin(115200);
  Serial.println("Bienvenido");
  pinMode(led_1, OUTPUT);
  pinMode(led_2, OUTPUT);
  pinMode(led_3, OUTPUT);
  menu();
}

void loop() {
  if(Serial.available() > 0){
    eleccion = Serial.readStringUntil('\n');
    num = eleccion.toInt();
    Serial.println(num);
    activar = 1;
  }

  if((num == 1 | num == 2) & activar == 1){
    if(num == 1){
      voltaje();
    }
    else if(num == 2){
      Serial.println("Indique la led (1-3) y tiempo en ms que desea que se prenda, sin espacios y separados por una coma");
      enviar = 0;
      //delay(3000);
      while(enviar == 0){
        if(Serial.available() > 0){
          settings = Serial.readString();
          Serial.println(settings);
          char delimitador = ',';
          int indice_delimitador = settings.indexOf(delimitador);
          String led_elegido = settings.substring(0, indice_delimitador);
          String tiempo_ms = settings.substring(indice_delimitador + 1);
          led = led_elegido.toInt();
          tiempo = tiempo_ms.toInt();
          delay(100);
          leds(led, tiempo);
        }
      }
    }

    menu();
    activar = 0;
  }
  else if (activar == 1){
    Serial.println("OPCIÓN NO VÁLIDA");
    menu();
    activar = 0;
  }
}

void menu(void){
  Serial.println("Escoja la opción que desea usar: ");
  Serial.println("1. Lectura ADC");
  Serial.println("2. Controlar LEDs");
  Serial.println("Ingrese el número de la opción: ");
}

void voltaje(void){
  float volt1 = 0.0;
  volt1 = analogReadMilliVolts(pot)/10.0;
  Serial.print("Voltaje: ");
  Serial.print(volt1);
  Serial.println(" V");
}

void leds(int led, int tiempo){
  if(led == 0 | tiempo == 0 | (led >= 4) | (led < 0)){
    Serial.println("Opción inválida, vuelva a colocar el valor");
  }
  else{
    if(led == 1){
      digitalWrite(led_1, HIGH);
      delay(tiempo);
      digitalWrite(led_1, LOW);
    }
    else if(led == 2){
      digitalWrite(led_2, HIGH);
      delay(tiempo);
      digitalWrite(led_2, LOW);
    }
    else if(led == 3){
      digitalWrite(led_3, HIGH);
      delay(tiempo);
      digitalWrite(led_3, LOW);
    }
    enviar = 1;
  }
}
